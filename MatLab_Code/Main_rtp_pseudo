% Description of the input parameters: 
%       infile: original magnetic anomaly data file
%       inc: inclination, unit: °
%       dec: declination, unit: °
%       inc2: pseudo inclination, unit: °
% Description of the output parameters: ：
%       outfile: result file
% Description of primary identifiers：
%       x, y: x, y verctor
%       nx, ny: number of points in x and y directions
%       dx, dy: spacing in x and y directions
%       g: anomaly before rtp
%       npts: extension points
%       grtp: anomaly after rtp
% Description of subroutine function：
%       readgrd.m: read surfer text grd file
%       taper2d.m: cosine attenuation edge extension
%       rtp_pi.m: pseudo inclination method for magnetic reduction to the pole (rtp)
%       savegrd.m: save surfer text grd file
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
clc;
clear;
close all;
infile = 'anomaly.grd'; 
%%%%%%%%%%%% I/O parameters %%%%%%%%%%%%%
inc = 0; 
dec = 0; 
inc2 = 30; 
outfile = 'anomaly_rtp_pi.grd'; 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
[g,x,y,nx,ny,dx,dy] = readgrd(infile);
[X,Y] = meshgrid(x,y);
nmax = max([nx ny]);
npts = 2^nextpow2(nmax);
% The pseudo inclination method for magnetic reduction to the pole (rtp)
grtp = rtp_pi(g,npts,ny,nx,dec,inc,inc2);
% Save
savegrd(grtp,x,y,nx,ny,outfile);
