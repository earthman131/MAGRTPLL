function rtpdata = rtp_pi(magc,npts,ny,nx,dec,inc,inc2)
inc=inc*pi/180;
dec=dec*pi/180;
inc2=inc2*pi/180;
xdiff=floor((npts-nx)/2); ydiff=floor((npts-ny)/2);
gf=taper2d(magc,npts,ny,nx,ydiff,xdiff);
f=fft2(gf,npts,npts);
fx=f;
L=cos(dec)*cos(inc);
M=sin(dec)*cos(inc);
N=sin(inc);
L1=cos(dec)*cos(inc2);
M1=sin(dec)*cos(inc2);
N1=sin(inc2);
wn=2.0*pi/(npts-1);
for I=1:npts/2
    for J=1:npts/2
        U=I*wn; V=J*wn;
        C=U*U+V*V;
        A=N*sqrt(U*U+V*V);
        B=L*U+M*V;
        A1=N1*sqrt(U*U+V*V);
        B1=L1*U+M1*V;
        temp1=A*A-B*B;
        temp2=-2*A*B;
        base=(A*A+B*B)*(A1*A1+B1*B1);
        base=1.0/base;
        Rpart=C*temp1*base;
        Ipart=C*temp2*base;
        temp3=real(f(I,J));
        temp4=imag(f(I,J));
        fx(I,J)=real(Rpart*temp3-temp4*Ipart)+1i*real(Rpart*temp4+Ipart*temp3);
        A=N*sqrt(U*U+V*V);
        B=-L*U+M*V;
        A1=N1*sqrt(U*U+V*V);
        B1=-L1*U+M1*V;
        temp1=A*A-B*B;
        temp2=-2*A*B;
        base=(A*A+B*B)*(A1*A1+B1*B1);
        base=1.0/base;
        Rpart=C*temp1*base;
        Ipart=C*temp2*base;
        temp3=real(f(npts-I+1,J));
        temp4=imag(f(npts-I+1,J));
        fx(npts-I+1,J)=real(Rpart*temp3-temp4*Ipart)+1i*real(Rpart*temp4+Ipart*temp3);
        A=N*sqrt(U*U+V*V);
        B=L*U-M*V;
        A1=N1*sqrt(U*U+V*V);
        B1=L1*U-M1*V;
        temp1=A*A-B*B;
        temp2=-2*A*B;
        base=(A*A+B*B)*(A1*A1+B1*B1);
        base=1.0/base;
        Rpart=C*temp1*base;
        Ipart=C*temp2*base;
        temp3=real(f(I,npts-J+1));
        temp4=imag(f(I,npts-J+1));
        fx(I,npts-J+1)=real(Rpart*temp3-temp4*Ipart)+1i*real(Rpart*temp4+Ipart*temp3);
        A=N*sqrt(U*U+V*V);
        B=-L*U-M*V;
        A1=N1*sqrt(U*U+V*V);
        B1=-L1*U-M1*V;
        temp1=A*A-B*B;
        temp2=-2*A*B;
        base=(A*A+B*B)*(A1*A1+B1*B1);
        base=1.0/base;
        Rpart=C*temp1*base;
        Ipart=C*temp2*base;
        temp3=real(f(npts-I+1,npts-J+1));
        temp4=imag(f(npts-I+1,npts-J+1));
        fx(npts-I+1,npts-J+1)=real(Rpart*temp3-temp4*Ipart)+1i*real(Rpart*temp4+Ipart*temp3);
    end
end
fxinv=ifft2(fx); rtpdata=real(fxinv(1+ydiff:ny+ydiff,1+xdiff:nx+xdiff));